/**
 * Accessibility Utilities
 * @remarks Screen reader support, focus indicators, reduced motion
 */

/* ===================================
   Screen Reader Only
   =================================== */

/**
 * Visually hide content while keeping it accessible to screen readers
 */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/**
 * Allow screen reader-only elements to be focusable when focused
 */
.sr-only-focusable:focus,
.sr-only-focusable:active {
  position: static;
  width: auto;
  height: auto;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* ===================================
   Skip Links
   =================================== */

.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  z-index: 10000;
  padding: var(--space-3) var(--space-4);
  background: var(--accent);
  color: var(--text-on-accent);
  font-weight: 600;
  text-decoration: none;
  border-radius: 0 0 var(--radius-md) 0;
  transition: top var(--duration-fast);
}

.skip-link:focus {
  top: 0;
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* ===================================
   Focus Indicators
   =================================== */

/**
 * Remove default outline for mouse users (but keep for keyboard users)
 */
:focus:not(:focus-visible) {
  outline: none;
}

/**
 * High-contrast focus indicator for keyboard navigation
 */
:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/**
 * Focus ring for interactive elements
 */
button:focus-visible,
a:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[tabindex]:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/**
 * Focus ring for custom interactive elements
 */
[role="button"]:focus-visible,
[role="link"]:focus-visible,
[role="tab"]:focus-visible,
[role="menuitem"]:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/**
 * Ensure focus indicators are visible in dark mode
 */
:root.dark-mode :focus-visible {
  outline-color: var(--accent);
}

/* ===================================
   Live Regions for Screen Readers
   =================================== */

#aria-live-region {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* ===================================
   High Contrast Mode
   =================================== */

/**
 * Ensure borders and outlines are visible in Windows High Contrast Mode
 */
@media (prefers-contrast: high) {
  button,
  input,
  select,
  textarea,
  .card,
  .modal,
  .panel {
    border: 2px solid currentColor;
  }

  :focus-visible {
    outline: 3px solid currentColor;
    outline-offset: 3px;
  }
}

/* ===================================
   Reduced Motion
   =================================== */

/**
 * Respect user's motion preferences
 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  /* Keep essential transitions */
  .essential-transition {
    transition-duration: 150ms !important;
  }
}

/* ===================================
   Keyboard Navigation Helpers
   =================================== */

/**
 * Indicate draggable items
 */
[draggable="true"] {
  cursor: grab;
}

[draggable="true"]:active {
  cursor: grabbing;
}

/**
 * Indicate clickable/interactive elements
 */
[role="button"],
[role="link"],
[role="tab"],
[role="menuitem"] {
  cursor: pointer;
}

/**
 * Disabled state
 */
[aria-disabled="true"],
:disabled {
  cursor: not-allowed;
  opacity: 0.6;
}

/* ===================================
   Touch Target Size
   =================================== */

/**
 * Ensure minimum touch target size (48x48px for WCAG AAA)
 */
@media (pointer: coarse) {
  button,
  a,
  input[type="checkbox"],
  input[type="radio"],
  [role="button"],
  [role="link"],
  [role="tab"] {
    min-height: 48px;
    min-width: 48px;
  }

  /* Exception for inline links in text */
  p a,
  li a {
    min-height: auto;
    min-width: auto;
  }
}

/* ===================================
   Color Contrast
   =================================== */

/**
 * Ensure text has sufficient contrast
 * These are fallback values if CSS custom properties fail
 */
:root {
  --text-primary-fallback: #1a1a1a;
  --text-secondary-fallback: #4a4a4a;
  --bg-fallback: #ffffff;
}

:root.dark-mode {
  --text-primary-fallback: #f5f5f5;
  --text-secondary-fallback: #d4d4d4;
  --bg-fallback: #1a1a1a;
}

/* ===================================
   Print Accessibility
   =================================== */

@media print {
  /* Expand all collapsed sections */
  [aria-hidden="true"] {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* Show link URLs */
  a[href]::after {
    content: " (" attr(href) ")";
    font-size: 0.9em;
    color: #666;
  }

  /* Remove skip links */
  .skip-link {
    display: none;
  }
}

/* ===================================
   ARIA States
   =================================== */

/**
 * Visual feedback for ARIA states
 */
[aria-busy="true"] {
  cursor: wait;
  opacity: 0.7;
}

[aria-expanded="false"] + [role="region"],
[aria-expanded="false"] + [aria-labelledby] {
  display: none;
}

[aria-expanded="true"] + [role="region"],
[aria-expanded="true"] + [aria-labelledby] {
  display: block;
}

[aria-selected="true"] {
  background: var(--accent-subtle);
  color: var(--accent);
}

[aria-current="page"],
[aria-current="step"] {
  font-weight: 600;
  color: var(--accent);
}

/* ===================================
   Form Accessibility
   =================================== */

/**
 * Required field indicator
 */
[aria-required="true"]::after,
[required]::after {
  content: " *";
  color: var(--error);
  font-weight: bold;
}

/**
 * Invalid field indicator
 */
[aria-invalid="true"],
:invalid:not(:focus) {
  border-color: var(--error);
  background: var(--error-subtle);
}

/**
 * Form error messages
 */
[role="alert"] {
  padding: var(--space-3);
  background: var(--error-subtle);
  color: var(--error);
  border-left: 3px solid var(--error);
  border-radius: var(--radius-sm);
  margin-top: var(--space-2);
}

/* ===================================
   Loading States
   =================================== */

/**
 * Loading spinner for screen readers
 */
[aria-busy="true"]::before {
  content: "Loading...";
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* ===================================
   Focus Within (for containers)
   =================================== */

/**
 * Style container when a child has focus
 */
.focus-within-highlight:focus-within {
  box-shadow: 0 0 0 3px var(--accent-subtle);
  border-color: var(--accent);
}
